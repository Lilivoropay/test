<!DOCTYPE html>
<html>
  <head>
    <title>Speckle Assembly Viewer</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script type="module">
      import Viewer from "https://unpkg.com/@speckle/viewer@2.16.6";

      const streamId = "d90ed744a3"
      const objectId = "733a102ccc"

      const container = document.getElementById("viewer")
      const viewer = await Viewer.create(container)
      await viewer.loadObject(`https://app.speckle.systems/streams/${streamId}/objects/${objectId}`)

      // Зчитування всіх елементів
      const elements = await viewer.getWorldTreeItems()
      const colors = ["#7f3fbf", "#1fa672", "#d96528", "#ffcc00", "#3273dc", "#f14668"]
      const assemblyGroups = {}

      let index = 0
      for (const el of elements) {
        const props = await viewer.getObjectProperties(el)
        const assembly = props?."Assembly Name"
        if (!assembly) continue

        if (!assemblyGroups[assembly]) {
          assemblyGroups[assembly] = {
            color: colors[index % colors.length],
            ids: []
          }
          index++
        }
        assemblyGroups[assembly].ids.push(el)
      }

      // Фарбування
      for (const group of Object.values(assemblyGroups)) {
        await viewer.setColor(group.ids, group.color)
      }
    </script>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
      }
      #viewer {
        width: 100vw;
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <div id="viewer"></div>
  </body>
</html>
